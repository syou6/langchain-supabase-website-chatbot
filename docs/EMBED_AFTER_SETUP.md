# 📋 埋め込み後の確認事項と次のステップ

埋め込みウィジェットをサイトに追加した後の確認事項と、推奨される次のアクションをまとめます。

---

## ✅ 埋め込み後の確認事項

### 1. ウィジェットの表示確認

**確認方法**:
1. スクリプトタグを埋め込んだページをブラウザで開く
2. ページの右下にチャットボタン（💬）が表示されることを確認
3. ボタンをクリックしてチャットウィンドウが開くことを確認

**確認ポイント**:
- ✅ チャットボタンが表示されている
- ✅ ボタンをクリックするとウィンドウが開く
- ✅ ウィンドウが正しく表示される（レイアウト崩れがない）

### 2. チャット機能のテスト

**テスト手順**:
1. チャットウィンドウを開く
2. サイトに関する質問を入力（例: 「このサイトについて教えて」）
3. 応答が返ってくることを確認
4. ストリーミング表示が正常に動作することを確認

**確認ポイント**:
- ✅ 質問を送信できる
- ✅ 応答が返ってくる
- ✅ ストリーミング表示が滑らか
- ✅ エラーメッセージが表示されない

### 3. ブラウザコンソールの確認

**確認方法**:
1. ブラウザの開発者ツールを開く（F12）
2. 「Console」タブを開く
3. エラーがないか確認

**確認ポイント**:
- ✅ JavaScriptエラーがない
- ✅ ネットワークエラーがない
- ✅ CORSエラーがない

### 4. モバイル表示の確認

**確認方法**:
1. ブラウザの開発者ツールでモバイル表示に切り替え
2. または実際のスマートフォンで確認
3. ウィジェットが正しく表示されることを確認

**確認ポイント**:
- ✅ チャットボタンが適切なサイズで表示される
- ✅ チャットウィンドウが画面に収まる
- ✅ タッチ操作が正常に動作する

---

## 📊 使用状況の確認

### ダッシュボードで確認

1. **使用状況ページ**: `/dashboard/usage`
   - 月間チャット回数
   - 埋め込みトークン数
   - コスト（USD）
   - クォータ使用率

2. **サイト詳細ページ**: `/dashboard/[siteId]`
   - サイトのステータス
   - 学習履歴
   - 埋め込み設定

### Supabaseで確認

**usage_logsテーブル**:
```sql
-- 埋め込みチャットの使用ログを確認
SELECT 
  action,
  tokens_consumed,
  cost_usd,
  created_at
FROM usage_logs
WHERE action = 'chat'
ORDER BY created_at DESC
LIMIT 10;
```

---

## 🔧 トラブルシューティング

### ウィジェットが表示されない

**原因と対処法**:

1. **`is_embed_enabled`が`false`**
   - 対処: 埋め込み設定ページで有効化

2. **サイトの`status`が`'ready'`でない**
   - 対処: 学習を完了させる

3. **スクリプトタグの配置が間違っている**
   - 対処: `</body>`タグの直前に配置する

4. **サイトIDが間違っている**
   - 対処: 正しい`site_id`を確認

### チャットが動作しない

**原因と対処法**:

1. **学習が完了していない**
   - 対処: サイトの学習を完了させる

2. **クォータ超過**
   - 対処: 使用状況ページで確認、プランアップグレードを検討

3. **APIエラー**
   - 対処: ブラウザコンソールでエラーを確認

---

## 🎨 カスタマイズ（将来の機能）

現在は基本的なウィジェットのみですが、将来的に以下のカスタマイズが可能になる予定です：

- **カラー設定**: ボタンやウィンドウの色を変更
- **位置設定**: ボタンの位置を変更（右下、左下など）
- **テキスト設定**: ボタンやウィンドウのテキストを変更
- **ロゴ設定**: ウィジェットにロゴを追加

---

## 📈 次のステップ

### 1. サイトの更新と再学習

サイトの内容が更新された場合：

1. ダッシュボードでサイトを選択
2. 「再学習」ボタンをクリック
3. 学習が完了するまで待つ
4. 新しい内容がチャットに反映される

### 2. 複数サイトへの埋め込み

複数のサイトを管理する場合：

1. 各サイトごとにスクリプトタグを取得
2. それぞれのサイトに適切なスクリプトタグを埋め込む
3. 各サイトの使用状況を個別に確認

### 3. プランのアップグレード

使用量が増えた場合：

1. `/dashboard/usage`で使用状況を確認
2. `/dashboard/plans`でプランを比較
3. 必要に応じてプランをアップグレード

---

## 🔍 モニタリング

### 定期的に確認すべき項目

1. **使用状況**: 月間の使用量とコスト
2. **エラーログ**: Supabaseのログでエラーがないか確認
3. **パフォーマンス**: チャットの応答時間
4. **ユーザーフィードバック**: 実際のユーザーからのフィードバック

### アラート設定（将来の機能）

以下のアラート設定が予定されています：

- クォータ使用率が80%を超えた場合
- エラー率が一定値を超えた場合
- コストが予算を超えた場合

---

## 📚 関連ドキュメント

- [埋め込み設定ページ](../pages/dashboard/sites/[siteId]/embed.tsx) - 埋め込み設定の詳細
- [埋め込みAPI](../pages/api/embed/script.ts) - 埋め込みスクリプトの実装
- [使用状況ページ](../pages/dashboard/usage.tsx) - 使用状況の確認方法

---

## 💡 ベストプラクティス

1. **テスト環境で確認**: 本番環境に埋め込む前に、テスト環境で動作確認
2. **定期的な確認**: 週に1回程度、使用状況を確認
3. **エラーログの監視**: 定期的にエラーログを確認
4. **パフォーマンス監視**: チャットの応答時間を監視
5. **ユーザーフィードバック**: 実際のユーザーからのフィードバックを収集

---

## 🆘 サポート

問題が発生した場合：

1. **ドキュメントを確認**: このドキュメントと関連ドキュメントを確認
2. **エラーログを確認**: ブラウザコンソールとSupabaseログを確認
3. **サポートに連絡**: 必要に応じてサポートチームに連絡

---

© 2025 WEBGPT.jp
