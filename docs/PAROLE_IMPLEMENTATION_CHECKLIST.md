# ✅ Parole機能実装チェックリスト

## 概要

Parole機能の実装を段階的に進めるためのチェックリストです。

---

## 📋 Phase 1: MVP実装（1-2週間）

### **Step 1: データベーススキーマ作成**

#### **テーブル作成**

- [ ] `chat_logs`テーブルの作成
- [ ] インデックスの作成
  - [ ] `idx_chat_logs_user_id`
  - [ ] `idx_chat_logs_site_id`
  - [ ] `idx_chat_logs_created_at`
  - [ ] `idx_chat_logs_session_id`
  - [ ] `idx_chat_logs_source`
  - [ ] `idx_chat_logs_question_search`（全文検索用）
- [ ] RLS（Row Level Security）ポリシーの設定
  - [ ] SELECTポリシー
  - [ ] INSERTポリシー
  - [ ] UPDATEポリシー

#### **関数作成**

- [ ] `get_question_ranking`関数の作成
- [ ] `get_keyword_frequency`関数の作成
- [ ] `get_question_timeline`関数の作成

#### **動作確認**

- [ ] テーブルが作成されたか確認
- [ ] 関数が作成されたか確認
- [ ] RLSポリシーが正しく動作するか確認

---

### **Step 2: チャットAPI修正**

#### **`/api/chat`の修正**

- [ ] ログ保存機能の追加
- [ ] セッションIDの生成/取得
- [ ] エラーハンドリングの実装
- [ ] ログ保存のエラーがチャット機能に影響しないことを確認

#### **`/api/embed/chat`の修正**

- [ ] ログ保存機能の追加
- [ ] セッションIDの生成/取得
- [ ] エラーハンドリングの実装
- [ ] ログ保存のエラーがチャット機能に影響しないことを確認

#### **動作確認**

- [ ] チャット機能が正常に動作するか確認
- [ ] ログが正しく保存されるか確認
- [ ] セッションIDが正しく生成されるか確認

---

### **Step 3: 分析API作成**

#### **`/api/insights/questions`**

- [ ] エンドポイントの作成
- [ ] 認証チェックの実装
- [ ] サイト所有者確認の実装
- [ ] クエリパラメータのバリデーション
- [ ] エラーハンドリングの実装
- [ ] テストの作成

#### **`/api/insights/keywords`**

- [ ] エンドポイントの作成
- [ ] 認証チェックの実装
- [ ] サイト所有者確認の実装
- [ ] クエリパラメータのバリデーション
- [ ] エラーハンドリングの実装
- [ ] テストの作成

#### **`/api/insights/timeline`**

- [ ] エンドポイントの作成
- [ ] 認証チェックの実装
- [ ] サイト所有者確認の実装
- [ ] クエリパラメータのバリデーション
- [ ] エラーハンドリングの実装
- [ ] テストの作成

#### **動作確認**

- [ ] 各APIが正常に動作するか確認
- [ ] 認証が正しく機能するか確認
- [ ] エラーレスポンスが正しいか確認

---

### **Step 4: ダッシュボードUI作成**

#### **ページ作成**

- [ ] `/dashboard/[siteId]/insights`ページの作成
- [ ] ルーティングの設定
- [ ] 認証チェックの実装

#### **コンポーネント作成**

- [ ] 概要カードコンポーネント
  - [ ] 今週の質問数
  - [ ] 今月の質問数
  - [ ] 最も多い質問カテゴリ
- [ ] 質問ランキングコンポーネント
  - [ ] ランキング表示
  - [ ] 期間フィルタ
  - [ ] ページネーション（必要に応じて）
- [ ] キーワードクラウドコンポーネント
  - [ ] キーワード表示
  - [ ] サイズの動的変更
- [ ] 時系列グラフコンポーネント
  - [ ] グラフ表示
  - [ ] 期間フィルタ
  - [ ] レスポンシブ対応

#### **スタイリング**

- [ ] プレミアムSaaS UIガイドライン準拠
- [ ] レスポンシブデザイン
- [ ] ダークモード対応
- [ ] アニメーション実装

#### **状態管理**

- [ ] ローディング状態の実装
- [ ] エラー状態の実装
- [ ] 空状態の実装

#### **動作確認**

- [ ] ページが正常に表示されるか確認
- [ ] データが正しく表示されるか確認
- [ ] フィルタが正常に動作するか確認
- [ ] レスポンシブデザインが正しく動作するか確認

---

## 🚀 Phase 2: 中級機能（1-2ヶ月）

### **Step 5: 類似質問クラスタリング**

#### **データベース拡張**

- [ ] `question_clusters`テーブルの作成
- [ ] `chat_logs.question_embedding`カラムの追加
- [ ] `chat_logs.cluster_id`カラムの追加
- [ ] ベクトルインデックスの作成
- [ ] pgvector拡張機能の有効化

#### **クラスタリングAPI**

- [ ] `/api/insights/cluster`エンドポイントの作成
- [ ] 質問のベクトル化処理
- [ ] 類似度計算の実装
- [ ] クラスタリングアルゴリズムの実装
- [ ] バッチ処理の実装

#### **UI実装**

- [ ] クラスタ一覧の表示
- [ ] クラスタ詳細の表示
- [ ] クラスタへの質問の追加機能

#### **動作確認**

- [ ] クラスタリングが正常に動作するか確認
- [ ] パフォーマンスが許容範囲内か確認

---

### **Step 6: 購入前/購入後分析**

#### **データベース拡張**

- [ ] セッション追跡機能の実装
- [ ] 購入イベントの記録機能
- [ ] タグ付け機能の実装

#### **分析API**

- [ ] `/api/insights/pre-post-analysis`エンドポイントの作成
- [ ] 購入前後の質問パターン比較
- [ ] コンバージョン影響分析

#### **UI実装**

- [ ] 購入前/後比較表示
- [ ] コンバージョン影響質問の表示

---

### **Step 7: CSVエクスポート**

#### **API実装**

- [ ] `/api/insights/export`エンドポイントの作成
- [ ] CSV生成機能の実装
- [ ] フィルタリング機能の実装

#### **UI実装**

- [ ] エクスポートボタンの追加
- [ ] フィルタ設定UI
- [ ] ダウンロード機能

---

## 🎨 Phase 3: 高度な機能（3-6ヶ月）

### **Step 8: AI改善提案**

#### **API実装**

- [ ] `/api/insights/suggestions`エンドポイントの作成
- [ ] GPT-4を使用した分析プロンプトの設計
- [ ] LangChainでのチェーン構築

#### **UI実装**

- [ ] 改善提案の表示
- [ ] LP改善ポイントの表示
- [ ] 価格戦略提案の表示

---

### **Step 9: 外部連携**

#### **Slack連携**

- [ ] Slack Webhookの設定
- [ ] 週次レポートの自動送信
- [ ] 重要な質問の通知

#### **Notion連携**

- [ ] Notion APIの連携
- [ ] データベースへの自動同期
- [ ] 認証設定

---

### **Step 10: マルチユーザー共有**

#### **データベース拡張**

- [ ] チームテーブルの作成
- [ ] 権限管理テーブルの作成

#### **API実装**

- [ ] ユーザー招待API
- [ ] 権限管理API
- [ ] コメント機能API

#### **UI実装**

- [ ] チーム管理画面
- [ ] ユーザー招待機能
- [ ] コメント機能

---

## 🧪 テスト

### **単体テスト**

- [ ] データベース関数のテスト
- [ ] APIエンドポイントのテスト
- [ ] コンポーネントのテスト

### **統合テスト**

- [ ] チャットAPI + ログ保存のテスト
- [ ] 分析API + UIのテスト

### **E2Eテスト**

- [ ] チャットからインサイト表示までのフロー
- [ ] フィルタリング機能のテスト

---

## 📊 パフォーマンス最適化

- [ ] インデックスの最適化
- [ ] クエリの最適化
- [ ] キャッシュ戦略の実装
- [ ] パーティション化の検討

---

## 🔒 セキュリティ

- [ ] RLSポリシーの確認
- [ ] 認証チェックの確認
- [ ] 入力バリデーションの確認
- [ ] SQLインジェクション対策の確認

---

## 📝 ドキュメント

- [ ] API仕様書の作成
- [ ] データベース設計書の作成
- [ ] UI/UX設計書の作成
- [ ] 実装ガイドの作成
- [ ] 運用マニュアルの作成

---

## 🚀 デプロイ

- [ ] ステージング環境へのデプロイ
- [ ] 本番環境へのデプロイ
- [ ] マイグレーションの実行
- [ ] 動作確認

---

## 進捗管理

### **Phase 1: MVP**
- 開始日: ___________
- 完了予定日: ___________
- 実際の完了日: ___________

### **Phase 2: 中級機能**
- 開始日: ___________
- 完了予定日: ___________
- 実際の完了日: ___________

### **Phase 3: 高度な機能**
- 開始日: ___________
- 完了予定日: ___________
- 実際の完了日: ___________

